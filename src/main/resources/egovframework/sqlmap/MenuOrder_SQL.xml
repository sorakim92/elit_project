<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="menuorder_space">

	<typeAlias  alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
	<typeAlias  alias="menuorderVO" type="egov.service1.MenuOrderVO"/>
	<typeAlias  alias="memberVO" type="egov.service1.MemberVO"/>
	
	

	<select id="menuorderDAO.selectStoreMenuList" resultClass="egovMap">
		select 	s.storeunq, 
				s.cateunq, 
				s.storename, 
				s.storeinfo,
				s.storerate,
                m.menuunq,
                m.menuname,
                m.menukeyword,
                m.menuinfo,
                m.price
		from 	store s, menu m
			where s.storeunq=m.storeunq and m.storeunq = #storeunq#

	
	</select>

	<select id="menuorderDAO.selectStoreinfo" resultClass="menuorderVO">
		SELECT 	storeunq, 
				storename,
				storerate, 
				decode(fee,0,'무료',fee) fee
				
		from 	store
			where storeunq = #storeunq#

	</select>
	
	
	<select id="menuorderDAO.selectStoreReviewTotalCount" resultClass="java.lang.Integer">
		SELECT count(*) FROM  storereview WHERE storeunq = #storeunq#
	
	</select>
	
	<select id="menuorderDAO.selectmenudetail" resultClass="menuorderVO" >
		select menuunq, menuname, price, storeunq from menu where menuunq= #menuunq#
	
	
	</select>
	
	<select id="menuorderDAO.countMenuunq" resultClass="java.lang.Integer">
		SELECT count(*)
		FROM	preorder
		WHERE 
				userid = #userid#
			AND
				menuunq = #menuunq#
	
	</select>
	
	
	
	<select id="menuorderDAO.selectPreOrderList" resultClass="egovMap">
		SELECT 	
				pindex,
				menuunq,
				menuname,
				price,
				qty,
				userid,
				storeunq
		FROM	
				preorder
		WHERE 
				storeunq = #storeunq# AND userid=#userid#
	
	</select>
	
	<select id = "menuorderDAO.selectTotPrice" resultClass="java.lang.Integer">
		SELECT 
				nvl(sum(price * qty),0) total 
		FROM 
				preorder 
		WHERE 	
				userid = #userid# 
			AND storeunq = #storeunq#
	
	</select>
	
	<select id="menuorderDAO.selectMemberInfo" resultClass="memberVO">
		SELECT userid,
				username,
				userphone,
				useraddr1,
				useraddr2,
				useraddr3
		FROM	member
		WHERE userid = #userid#
	
	
	</select>
	
	<insert id="menuorderDAO.insertAddOrder" parameterClass="menuorderVO">
		INSERT INTO preorder(
						pindex, 
						menuunq, 
						menuname,
						price,
						qty,
						storeunq,
						userid)
						VALUES(preorder_seq.nextval,
								$menuunq$,
								#menuname#,
								#price#,
								#qty#,
								#storeunq#,
								#userid#)
	</insert>
	


	<update id="menuorderDAO.updateqty">
	
		UPDATE preorder SET qty = qty+1 
		WHERE menuunq=#menuunq# AND userid = #userid#
	
	</update>


	<delete id="menuorderDAO.deleteOrderMenu" >
		DELETE FROM preorder 
				WHERE  userid = #userid# AND menuunq = #menuunq#
				
	</delete>

</sqlMap>