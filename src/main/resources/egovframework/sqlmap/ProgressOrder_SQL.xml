<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >


<sqlMap namespace = "progressorder_space">
	<typeAlias  alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
	<typeAlias  alias="progressorderVO" type="egov.service1.ProgressOrderVO"/>

	
	<select id="progressorderDAO.selectProgressOrderList"  resultClass="egovMap"  >
		SELECT 
				    menuname, 
					price, 
					comment1,
					comment2,
					phone,
					to_char(rdate,'hh24:mi/ss')rdate,
					userid
		FROM progressorder 
			where storeunq = '123'
		
		  		
	</select>
	
	
	<select id="progressorderDAO.selectorderendList"  resultClass="egovMap"  >
		SELECT 
				    comment1,
				    comment2, 
					price, 
					menuname,
					method,
					phone,
					to_char(rdate,'hh24:mi/ss')rdate,
					addr
		FROM progressorder 
			where storeunq = '123'
		
		  		
	</select>
	
	<!-- 메인페이지에 아이디로 로그인시 진행중인 메뉴 조회  -->
	
	<select id="progressorderDAO.selectMainProOrder" resultClass="egovMap">
		SELECT 
		        orderindex,
		        menuname,
		        map,
		        addr, 
		        userid, 
		        phone, 
		        storeunq,
		        acctime
		FROM 
		        progressorder 
		WHERE 
		        userid=#userid#
		AND 
		        accept='Y' 
		AND 
		        receive='P'
	
	</select>
	
	
	

	<!--  주문내역 progressorder 테이블로 저장 (소라) -->
	<insert id = "progressorderDAO.insertProgressOrder" >
		INSERT INTO progressorder 
					(orderindex, 
					menuname, 
					price, 
					comment1,
					comment2,
					phone,
					map,
					addr, 
					method,
					rdate,
					storeunq, 
					userid) 
			VALUES 
					(progressorder_seq.nextval,
					#menuname#,
					#price#,
					#comment1#,
					#comment2#,
					#phone#,
					null,
					#addr#,
					'k',
					sysdate,
					#storeunq#,
					#userid#)
	
	</insert>
	<!-- 주문완료시 preorder 정보 지우기 (소라) -->
	<delete id="progressorderDAO.resetpreorder" >
		DELETE FROM preorder 
				WHERE  userid = #userid# and storeunq = #storeunq#
	</delete>


</sqlMap>