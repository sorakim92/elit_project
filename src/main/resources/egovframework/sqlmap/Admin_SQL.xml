<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >

<sqlMap namespace = "Admin_space">
	<typeAlias  alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
	<typeAlias  alias="adminVO" type="egov.service1.AdminVO"/>
	
	<select id="adminDAO.selectadminService" resultClass = "egovMap">

	SELECT b.* FROM (
			SELECT rownum rn, a.* from (	
				SELECT  empid,
						passwd,
						phone,
						email,
						to_char(hiredate,'yyyy/mm/dd') hiredate,
						ename||'님' ename,
						decode(section,'Y','[시스템관리자]','N','회원') section
				FROM	
						emp
				WHERE	
						empid IS NOT NULL
				<isNotNull property="ktext">
					<isNotEmpty property="ktext">
					and (
					<!-- 오라클데이터의 Y값이 아닌 한글을 입력해도 검색어에 나오도록하기 -->
					<isEqual property = "ktext" compareValue="관리">
						section LIKE 'Y'
					</isEqual>
					<isEqual property = "ktext" compareValue="관리자">
						section LIKE 'Y'
					</isEqual>
					<isEqual property = "ktext" compareValue="시스템">
						section LIKE 'Y'
					</isEqual>
					<isEqual property = "ktext" compareValue="시스템관리자">
						section LIKE 'Y'
					</isEqual>
					<isEqual property = "ktext" compareValue="회원">
						section LIKE 'N'
					</isEqual>
					
					<!-- 위의 단어수 만큼 isnotequal만들어주자 -->
					<isNotEqual property = "ktext" compareValue="관리">
					<isNotEqual property = "ktext" compareValue="관리자">
					<isNotEqual property = "ktext" compareValue="시스템">
					<isNotEqual property = "ktext" compareValue="시스템관리자">
					<isNotEqual property = "ktext" compareValue="회원">
						 empid   LIKE '%$ktext$%'
					OR   ename   LIKE '%$ktext$%'
					OR   phone   LIKE '%$ktext$%'
					OR   section LIKE '%$ktext$%' 
					</isNotEqual>
					</isNotEqual>
					</isNotEqual>
					</isNotEqual>
					</isNotEqual>
					
					)
					</isNotEmpty>
				</isNotNull>
				
				ORDER BY hiredate DESC) a )b	
	</select>
	
	<!-- 관리자 추가 -->
	<update id ="adminDAO.adminPlus">
		UPDATE
				emp
		SET
				section = 'Y'
		WHERE
				empid = #empid#
	</update>
	
	<!-- 관리자 박탈 -->
	<update id = "adminDAO.adminDelete">
		UPDATE
				emp
		SET
				section = 'N'
		WHERE
				empid = #empid#
		
	</update>
	
	
	
	
	
</sqlMap>